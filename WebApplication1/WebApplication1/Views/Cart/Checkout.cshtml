@model WebApplication1.Models.Order

@{
    ViewData["Title"] = "結帳";
}

<div class="checkout-container">
    <div class="checkout-header">
        <h1><i class="fas fa-credit-card"></i> 結帳</h1>
        <div class="checkout-steps">
            <div class="step active">
                <span class="step-number">1</span>
                <span class="step-label">填寫資料</span>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <span class="step-number">2</span>
                <span class="step-label">確認訂單</span>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <span class="step-number">3</span>
                <span class="step-label">完成</span>
            </div>
        </div>
    </div>

    <form asp-action="SubmitOrder" method="post" class="checkout-form">
        <div class="checkout-content">
            <!-- 左側：訂單資訊表單 -->
            <div class="checkout-form-section">
                <!-- 聯絡資訊 -->
                <div class="form-card">
                    <h3><i class="fas fa-user"></i> 聯絡資訊</h3>
                    <div class="form-group">
                        <label asp-for="CustomerName">姓名 <span class="required">*</span></label>
                        <input asp-for="CustomerName" class="form-control" required placeholder="請輸入您的姓名">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label asp-for="Phone">電話 <span class="required">*</span></label>
                            <input asp-for="Phone" class="form-control" required placeholder="0912-345-678">
                        </div>
                        <div class="form-group">
                            <label asp-for="Email">Email</label>
                            <input asp-for="Email" type="email" class="form-control" placeholder="example@email.com">
                        </div>
                    </div>
                </div>

                <!-- 取貨方式 -->
                <div class="form-card">
                    <h3><i class="fas fa-truck"></i> 取貨方式</h3>
                    <div class="delivery-options">
                        <label class="delivery-option">
                            <input type="radio" name="DeliveryMethod" value="pickup" checked onchange="toggleDeliveryAddress()">
                            <div class="option-content">
                                <i class="fas fa-store"></i>
                                <span>到店取貨</span>
                            </div>
                        </label>
                        <label class="delivery-option">
                            <input type="radio" name="DeliveryMethod" value="delivery" onchange="toggleDeliveryAddress()">
                            <div class="option-content">
                                <i class="fas fa-shipping-fast"></i>
                                <span>外送服務</span>
                            </div>
                        </label>
                    </div>

                    <div id="deliveryAddressSection" style="display: none; margin-top: 1rem;">
                        <div class="form-group">
                            <label asp-for="DeliveryAddress">外送地址 <span class="required">*</span></label>
                            <input asp-for="DeliveryAddress" class="form-control" placeholder="請輸入完整地址">
                        </div>
                    </div>
                </div>

                <!-- 付款方式 -->
                <div class="form-card">
                    <h3><i class="fas fa-money-bill-wave"></i> 付款方式</h3>
                    <div class="payment-options">
                        <label class="payment-option">
                            <input type="radio" name="PaymentMethod" value="cash" checked>
                            <div class="option-content">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>現金付款</span>
                            </div>
                        </label>
                        <label class="payment-option">
                            <input type="radio" name="PaymentMethod" value="card">
                            <div class="option-content">
                                <i class="fas fa-credit-card"></i>
                                <span>信用卡</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 備註 -->
                <div class="form-card">
                    <h3><i class="fas fa-comment"></i> 訂單備註</h3>
                    <div class="form-group">
                        <textarea asp-for="Note" class="form-control" rows="3" placeholder="有什麼想告訴我們的嗎？（選填）"></textarea>
                    </div>
                </div>
            </div>

            <!-- 右側：訂單摘要 -->
            <div class="checkout-summary-section">
                <div class="checkout-summary">
                    <h3>訂單明細</h3>
                    <div class="summary-items">
                        @foreach (var item in Model.Items)
                        {
                            <div class="summary-item">
                                <div class="summary-item-info">
                                    <h4>@item.DrinkName</h4>
                                    <div class="summary-item-options">
                                        @(item.Temperature == "hot" ? "熱" : "冰")
                                        @if (!string.IsNullOrEmpty(item.SweetLevel))
                                        {
                                            <span> · @item.SweetLevel</span>
                                        }
                                        @if (!string.IsNullOrEmpty(item.IceLevel) && item.Temperature == "cold")
                                        {
                                            <span> · @item.IceLevel</span>
                                        }
                                    </div>
                                </div>
                                <div class="summary-item-price">
                                    <span class="qty">x @item.Quantity</span>
                                    <span class="price">NT$ @item.Subtotal</span>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="summary-divider"></div>

                    <div class="summary-row">
                        <span>商品小計</span>
                        <span>NT$ @Model.TotalAmount</span>
                    </div>
                    <div class="summary-row">
                        <span>運費</span>
                        <span>NT$ 0</span>
                    </div>

                    <div class="summary-divider"></div>

                    <div class="summary-total">
                        <span>總計</span>
                        <span class="total-amount">NT$ @Model.TotalAmount</span>
                    </div>

                    <button type="submit" class="btn btn-submit-order">
                        <i class="fas fa-check-circle"></i> 確認訂單
                    </button>

                    <a href="@Url.Action("Index", "Cart")" class="btn btn-back">
                        <i class="fas fa-arrow-left"></i> 返回購物車
                    </a>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <script>
        function toggleDeliveryAddress() {
            const deliveryMethod = $('input[name="DeliveryMethod"]:checked').val();
            const addressSection = $('#deliveryAddressSection');
            const addressInput = $('input[name="DeliveryAddress"]');

            if (deliveryMethod === 'delivery') {
                addressSection.slideDown();
                addressInput.prop('required', true);
            } else {
                addressSection.slideUp();
                addressInput.prop('required', false);
            }
        }

        // 表單驗證
        $(document).ready(function () {
            $('.checkout-form').on('submit', function (e) {
                const deliveryMethod = $('input[name="DeliveryMethod"]:checked').val();
                if (deliveryMethod === 'delivery') {
                    const address = $('input[name="DeliveryAddress"]').val();
                    if (!address) {
                        e.preventDefault();
                        alert('請輸入外送地址');
                        return false;
                    }
                }
            });
        });
    </script>
}


