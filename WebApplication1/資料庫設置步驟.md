# 📊 MS SQL 資料庫設置步驟

## 🎯 快速開始

### 方法一：使用 SQL Server Management Studio (SSMS)

1. **打開 SSMS**
   - 連接到您的 SQL Server 實例
   - 通常連接到 `localhost` 或 `(local)`

2. **執行 SQL 腳本**
   - 點擊 `File` → `Open` → `File...`
   - 選擇 `database_setup.sql` 檔案
   - 點擊 `Execute` 按鈕（或按 F5）

3. **確認結果**
   - 檢查輸出訊息
   - 應該看到「✅ 資料庫 DrinkShopDB 已成功創建並插入測試資料！」

### 方法二：使用 Visual Studio

1. **打開 SQL Server Object Explorer**
   - 在 Visual Studio 中，點擊 `View` → `SQL Server Object Explorer`

2. **連接到資料庫**
   - 展開 SQL Server 連接
   - 右鍵點擊 `Databases` → `Add New Database`

3. **執行腳本**
   - 右鍵點擊資料庫實例 → `New Query...`
   - 複製貼上 `database_setup.sql` 的內容
   - 點擊執行按鈕

### 方法三：使用命令列 (sqlcmd)

```bash
sqlcmd -S localhost -E -i database_setup.sql
```

## 📋 腳本內容說明

### 1️⃣ 創建資料庫
```sql
CREATE DATABASE DrinkShopDB;
```
- 資料庫名稱：`DrinkShopDB`

### 2️⃣ 創建表格

#### DrinkCategories（飲品分類表）
| 欄位名稱 | 資料型別 | 說明 |
|---------|---------|------|
| Id | INT (主鍵) | 分類編號 |
| Name | NVARCHAR(50) | 分類名稱 |
| Description | NVARCHAR(200) | 分類描述 |
| IconClass | NVARCHAR(50) | 圖示 CSS 類別 |
| SortOrder | INT | 排序順序 |
| IsActive | BIT | 是否啟用 |
| CreatedAt | DATETIME2 | 建立時間 |

#### Drinks（飲品表）
| 欄位名稱 | 資料型別 | 說明 |
|---------|---------|------|
| Id | INT (主鍵) | 飲品編號 |
| Name | NVARCHAR(100) | 飲品名稱 |
| Description | NVARCHAR(500) | 飲品描述 |
| Price | DECIMAL(18,2) | 價格 |
| CategoryId | INT (外鍵) | 分類編號 |
| ImageUrl | NVARCHAR(500) | 圖片網址 |
| IsAvailable | BIT | 是否供應 |
| IsHot | BIT | 是否可做熱飲 |
| IsCold | BIT | 是否可做冷飲 |
| IsSeasonal | BIT | 是否季節限定 |
| SortOrder | INT | 排序順序 |
| CreatedAt | DATETIME2 | 建立時間 |
| UpdatedAt | DATETIME2 | 更新時間 |

### 3️⃣ 插入測試資料

- **7 個分類**：
  1. 經典茶類（8 款飲品）
  2. 水果茶類（9 款飲品）
  3. 鮮奶茶類（4 款飲品）
  4. 奶蓋茶類（4 款飲品）
  5. 特色飲品（9 款飲品）
  6. 咖啡飲品（4 款飲品）
  7. 季節限定（2 款飲品）

- **40 款飲品**，包含完整資訊

## 🔍 驗證資料

執行以下 SQL 查詢來檢查資料：

```sql
-- 查看所有分類
SELECT * FROM DrinkCategories;

-- 查看所有飲品
SELECT * FROM Drinks;

-- 查看每個分類的飲品數量
SELECT 
    c.Name AS [分類名稱],
    COUNT(d.Id) AS [飲品數量]
FROM DrinkCategories c
LEFT JOIN Drinks d ON c.Id = d.CategoryId
GROUP BY c.Name, c.SortOrder
ORDER BY c.SortOrder;
```

## 🔗 連接字串

設置完成後，在 `appsettings.json` 中使用以下連接字串：

```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Server=localhost;Database=DrinkShopDB;Trusted_Connection=True;TrustServerCertificate=True;"
  }
}
```

### 常見連接字串格式：

#### 使用 Windows 驗證（推薦）：
```
Server=localhost;Database=DrinkShopDB;Trusted_Connection=True;TrustServerCertificate=True;
```

#### 使用 SQL Server 驗證：
```
Server=localhost;Database=DrinkShopDB;User Id=你的帳號;Password=你的密碼;TrustServerCertificate=True;
```

#### SQL Express：
```
Server=localhost\\SQLEXPRESS;Database=DrinkShopDB;Trusted_Connection=True;TrustServerCertificate=True;
```

## 🛠️ 常見問題

### Q1: 權限不足？
**A:** 確保您的 SQL Server 登入帳戶有創建資料庫的權限。

### Q2: 連接失敗？
**A:** 檢查：
- SQL Server 服務是否正在運行
- TCP/IP 協定是否啟用
- 防火牆設定

### Q3: 資料庫已存在？
**A:** 腳本會自動刪除舊的資料庫並重新創建（注意：會清空所有資料！）

### Q4: 想要保留舊資料？
**A:** 請手動編輯 `database_setup.sql`，移除或註解掉刪除資料庫的部分：
```sql
-- IF EXISTS (SELECT * FROM sys.databases WHERE name = 'DrinkShopDB')
-- BEGIN
--     ALTER DATABASE DrinkShopDB SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
--     DROP DATABASE DrinkShopDB;
-- END
```

## 📝 下一步

資料庫設置完成後：

1. ✅ 安裝 Entity Framework Core 套件
2. ✅ 創建 DbContext
3. ✅ 實作 DatabaseDrinkService
4. ✅ 修改 Program.cs 切換到資料庫服務

詳細步驟請參考 `資料庫升級說明.md` 檔案。

## 🎉 完成！

現在您的資料庫已經準備好了，可以開始連接應用程式了！


